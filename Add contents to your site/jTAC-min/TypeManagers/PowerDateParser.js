jTAC.require("TypeManagers.BaseDate");jTAC._internal.temp._TypeManagers_PowerDateParser={constructor:function(a){if(a!=null){owner=a.owner}},config:{defaultYear:null,defaultMonth:null,moreDateSeps:null,cultureNeutral:true,monthAllows:0,monthAsTwoCharName:true,insertDateSeps:true,trimParts:false},configrules:{defaultYear:jTAC.checkAsIntOrNull,defaultMonth:jTAC.checkAsIntOrNull,moreDateSeps:jTAC.checkAsStrOrNull,monthAllows:{values:[0,1,2,3],clearCache:true}},owner:null,parse:function(h){var a=this.owner;if(!a){this._error("Must assign the owner field.")}var j,g,u=a.getDateFormat()<10,t=a.dateTimeFormat("ShortDateSep"),b=this.config;h=jTAC.trimStr(h);if(b.cultureNeutral&&(t!="-")&&(h.indexOf("-")==4)){var l=this._internal.cnRE;if(!l){l=this._internal.cnRE=/^(\d{4})\-(\d{1,2})-(\d{1,2})$/}g=l.exec(h)}if(!g){if(u){if(b.moreDateSeps){var l=new RegExp("["+jTAC.escapeRE(b.moreDateSeps)+"]","ig");h=h.replace(l,t)}if(!b.trimParts&&(t!=" ")&&/[ ]/.test(h)){this._inputError("Spaces not allowed")}if(b.insertDateSeps&&(h.length>2)&&(h.indexOf(t)==-1)){h=this._insertDSeps(h)}}}var f=0,o=0,w=0,q=a._patternOrder(true,"dMy"),n,c=0,s;if(g){n=[g[1],g[2],g[3]];q=["y","M","d"]}else{if(u){n=h.split(t)}else{n=this._splitNonShort(h)}}if(n.length>q.length){return null}for(s=0;(c<n.length)&&(s<q.length);s++){var p=n[c];switch(q[s]){case"d":w=parseInt(p,10);if(!isNaN(w)&&(w>0)){c++}else{this._inputError("Invalid day number")}break;case"M":if((n.length==1)&&(q.length==3)){break}if(o==0){if(n[c]==""){o=0;c++;break}else{o=this._parseMonth(p)}if(isNaN(o)){o=0;c++}else{if((o<=12)&&(o>0)){c++}else{this._inputError("Invalid month")}}}break;case"y":if((n.length<3)&&(q.length==3)){break}if(f==0){if(p==""){f=0;break}else{f=parseInt(p,10)}var e="Illegal year";if(isNaN(f)){c++;this._inputError(e)}else{if(f<=9999){if(f<100){if(a.getTwoDigitYear()){f+=(2000+f)<a.dateTimeFormat("TwoDigitYearMax")?2000:1900}else{this._inputError(e)}}c++}else{this._inputError(e)}}}break}}if((o==0)&&(w==0)&&(f==0)){this._inputError("Missing digits")}if(o==0){o=this.getDefaultMonth()+1}if(w==0){w=1}if(f==0){f=this.getDefaultYear()}var k,v;if(b.useUTC){j=jTAC.TypeManagers.Base.prototype.asUTCDate(f,o-1,w);k=j.getUTCFullYear();v=j.getUTCMonth()}else{j=new Date(f,o-1,w,0,0,0,0);k=j.getFullYear();v=j.getMonth()}if((k!=f)||(v!=(o-1))){this._inputError("Day exceeds month range")}return{y:f,M:o,d:w}},_parseMonth:function(p){var d=this.owner,c=this.config,l=this.getMonthAllows(),g=p.charAt(0);if((g>="0")&&(g<="9")){if(l<2){return parseInt(p,10)}this._inputError("Month name required.")}else{if(l==1){this._inputError("Months must be digits.")}var b=d.getDateFormat();if((l==3)&&(b==20)){l=2}var e=d.dateTimeFormat("Months");var h=d.dateTimeFormat("MonthsAbbr");var o=this._cache.monthNames;if(o===undefined){o=((b<10)||(l==3))?h:e;for(var k=0;k<o.length;k++){o[k]=o[k].toUpperCase()}this._cache.monthNames=o}if(o){var m=p.length;p=p.toUpperCase();for(var f=0;f<=1;f++){for(var k=0;k<o.length;k++){var a=o[k];if(!a){continue}if(m>=a.length){if(p.indexOf(a)==0){if((l==3)&&(m>a.length)){this._inputError("Full name not allowed")}return k+1}}else{if(a.indexOf(p)==0){return k+1}}}if(!c.monthAsTwoCharName){break}var n=b==10;if((m>2)||n){m=2;p=p.substr(0,2);if(n){o=h}}else{break}}return 0}else{return 0}}},_splitNonShort:function(g){var d,b,e,a=this.owner;var c=a._datePattern();b=this._removeLiterals(c);if(b){for(d=1;d<b.length;d++){if(/^[^'"]/.test(b[d])){g=g.replace(b[d]," ")}}}e=/([A-Za-z\u00C0-\u7FFF]+([\s'][A-Za-z\u00C0-\u7FFF]+)?)|(\d+)/ig;var f=[];for(d=0;d<3;d++){b=e.exec(g);if(b){f.push(b[0])}else{if(d==0){this._inputError("y/m/d parts not found")}else{break}}}return f},_insertDSeps:function(n){var l=n.length,c=this.owner,b=c.getDateFormat(),m=0,e=-1,k,j;if((b==1)||(b==2)){var k=0;var p=n.toUpperCase();for(var j=0;j<l;j++){var h=p.charAt(j);if(!((h>="0")&&(h<="9"))){if(e==-1){e=j}m++;k=1}else{if(k){break}}}}var d=c._patternOrder(true,"dMy");var g=[];for(var j=0;j<d.length-1;j++){switch(d[j]){case"d":if((j==0)&&(e==1)){g[j]=1}else{g[j]=2}break;case"M":if(m>0){g[j]=m}else{if(l%2==0){g[j]=2}else{g[j]=1}}break;case"y":if(l>=5){if(l>=7){g[j]=4}else{g[j]=2}}break}}var o=c.dateTimeFormat("ShortDateSep");var a="";if(d.length==3){a=n.substring(0,g[0])+o+n.substring(g[0],g[0]+g[1]);if(l>4){a=a+o+n.substring(g[0]+g[1],l+1)}}else{if(g[0]<n.length){a=n.substring(0,g[0])+o+n.substring(g[0],l+1)}else{a=n}}return a},_removeLiterals:function(a){var b=this._internal.REPtnLit;if(!b){b=this._internal.REPtnLit=/(['"]([^'"]+)['"])(?:[^'"]+(['"]([^'"]+)['"])?)?/}return b.exec(a)},valChars:function(a){return a},getDefaultYear:function(){var b=this.config.defaultYear;if(b==null){var a=new Date();b=this.config.defaultYear=a.getFullYear()}return b},getDefaultMonth:function(){var a=this.config.defaultMonth;if(a==null){var b=new Date();a=this.config.defaultMonth=b.getMonth()}return a}};jTAC.define("TypeManagers.PowerDateParser",jTAC._internal.temp._TypeManagers_PowerDateParser);jTAC.plugInParser("TypeManagers.PowerDateParser","TypeManagers.BaseDate");