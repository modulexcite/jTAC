/*! -----------------------------------------------------------
JavaScript Types and Conditions ("jTAC")
Copyright (C) 2012  Peter L. Blum

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
------------------------------------------------------------- */
var jTAC=(function(){var definitions={};var aliases={};function define(fullClassName,members,replace){function member(name,typeName,missing,del){var val=members[name]||missing;if(val!=null){if(typeof val!=typeName){me.error(name+" parameter must be a "+typeName+".")}}delete members[name];return val}var me=jTAC;try{pushContext("jTAC.define('"+fullClassName+"')");if(!members||(typeof members!="object")){me.error("Members parameter must be an object.")}var nspath=fullClassName.split(".");var className=nspath.pop();var definition=definitions[fullClassName];if(definition&&!replace){me.error("["+fullClassName+"] is already defined.")}var parentName=member("extend","string",null);if(parentName){me.require(parentName)}var parentClass=parentName?me.getClass(parentName,true):null;var ctor=member("constructor","function",null);if(ctor&&ctor.toString().indexOf("function Object()")>-1){ctor=null}if(!ctor){ctor=function(propertyVals){if(parentClass){this.$parentClass.prototype.$ctor(propertyVals)}}}var newconfig=member("config","object");var newconfigrules=member("configrules","object");var abs=member("abstract","boolean",false);var require=members.require||null;if(require){if((typeof require!="string")&&!(require instanceof Array)){me.error("require property must be a string or array of strings")}jTAC.require(require)}delete members.require;var config=function(){};if(parentClass){config.prototype=new parentClass.prototype.config()}if(newconfig){me.extend(newconfig,config.prototype)}var configrules=function(){};if(parentClass){configrules.prototype=new parentClass.prototype.configrules()}if(newconfigrules){me.extend(newconfigrules,configrules.prototype)}_setupConfigRules(config.prototype,configrules);var newClass=function(){this.$className=className;this.$parentName=parentName||"";this.$parentClass=parentClass;this.$fullClassName=fullClassName;this.$require=require;this.$abstract=abs;this.$uniqueid=jTAC._internal.uniqueid++;this.config={};this._internal={};this._cache={};me.extend(config.prototype,this.config,true);this.configrules={};me.extend(configrules.prototype,this.configrules,true);if(config){this._defineProperties.call(this,config)}};_buildUserPath.call(me,nspath,className,newClass);if(parentClass){newClass.prototype=new parentClass()}else{me.extend(jTACClassBase,newClass.prototype)}me.extend(members,newClass.prototype);if(newconfig){newClass.prototype._autoGetSet.call(newClass,newconfig,configrules)}newClass.prototype.config=config;newClass.prototype.configrules=configrules;newClass.prototype.$ctor=ctor;_registerNewMethodNames(newClass,parentClass,fullClassName);definitions[fullClassName]={ctor:newClass,inst:new newClass()}}finally{popContext()}}function isDefined(fullClassName){return jTAC.getClass(fullClassName,false)!=null}function addMembers(fullClassName,members){try{pushContext("jTAC.addMembers('"+fullClassName+"')");var me=jTAC;if(typeof members=="object"){var def=jTAC.getDefinition(fullClassName);if(!def){me.error("className ["+fullClassName+"] not defined. Requires a case sensitive match.")}var proto=def.ctor.prototype;var config=null;for(var name in members){switch(name){case"config":config=members[name];me.extend(config,proto.config.prototype);break;case"configrule":me.extend(members[name],proto.configrules.prototype);break;default:proto[name]=members[name];if(typeof proto[name]=="function"){proto[name].$owner=def.inst.$parentClass;proto[name].$name=name;proto[name].$fullClassName=def.inst.$fullClassName}break}}if(config){_setupConfigRules(config,proto.configrules);proto._autoGetSet.call(def.ctor,config,proto.configrules)}}else{me.error("Illegal param")}}finally{popContext()}}function createByClassName(fullClassName,propertyVals,optional){try{pushContext("jTAC.createByClassName('"+fullClassName+"')");var me=jTAC;var classFnc=me.getClass(fullClassName,false);if(classFnc==null){if(optional){return null}_scriptFileMissing(fullClassName)}var obj=new classFnc();if(obj.$abstract){me.error("Cannot create ["+fullClassName+"]. It is marked abstract.")}obj.init.call(obj,propertyVals);return obj}finally{popContext()}}function _scriptFileMissing(fullClassName){jTAC.error("className ["+fullClassName+"] not defined. Check that the script file is loaded. The name is case sensitive.")}function require(fullClassNames){if(typeof(fullClassNames)=="string"){fullClassNames=[fullClassNames]}for(var i=0;i<fullClassNames.length;i++){var r=jTAC.getClass(fullClassNames[i],false);if(!r){_scriptFileMissing(fullClassNames[i])}}}function defineAlias(aliasName,fullClassName,propertyVals,replace,optional){var me=jTAC;if(aliases[aliasName]&&!replace){me.error("alias named ["+aliasName+"] is already defined.")}var cl=me.getClass(fullClassName,!optional);if(cl){if(propertyVals===undefined){propertyVals=null}aliases[aliasName]={className:fullClassName,propertyVals:propertyVals}}}function create(name,propertyVals,optional){try{pushContext("jTAC.create('"+name+"')");var me=jTAC;if(!name){if(!propertyVals){me.error("Must supply parameters")}name=propertyVals.jtacClass;if(!name){me.error("Must either pass a class name or assign the jtacClass property to a class name in the propertyVals object.")}}var alias=aliases[name];if(alias){var obj=me.create(alias.className,alias.propertyVals);if(propertyVals){if(typeof propertyVals=="function"){propertyVals.call(obj,obj,alias.className,name)}else{obj.setProperties.call(obj,propertyVals)}}return obj}return me.createByClassName(name,propertyVals,optional)}finally{popContext()}}function _buildUserPath(namespaces,className,ctor){var me=jTAC;var current=me;var nspath=namespaces;if(typeof namespaces=="string"){nspath=namespaces?namespaces.split("."):[]}for(var i=0;i<nspath.length;i++){var name=nspath[i];if(name=="jTAC"){continue}if(!name){me.error("Empty namespace is illegal")}var child=current[name];if(!child){current[name]=child={};child._parent=current}current=child}current[className]=ctor}function getClass(fullClassName,throwError){var def=getDefinition(fullClassName);if(!def){if(throwError){_scriptFileMissing(fullClassName)}return null}return def.ctor}function getDefinition(fullClassName){var me=jTAC;fullClassName=fullClassName.replace("jTAC.","");return definitions[fullClassName]}function inheritsFrom(fullClassName,anotherClassName){var def=getDefinition(fullClassName);if(!def){_scriptFileMissing(fullClassName)}return def.inst.instanceOf(anotherClassName)}function _setupConfigRules(config,configrules){for(var name in config){var obj=configrules.prototype[name];var fnc=null;if(obj){if(typeof obj=="function"){configrules.prototype[name]={valFnc:obj};continue}else{if(obj instanceof Array){configrules.prototype[name]={values:obj};continue}else{fnc=obj.valFnc}}}if(fnc){continue}if(obj&&obj.values){continue}var val=config[name];switch(typeof val){case"boolean":fnc=jTAC.checkAsBool;break;case"number":fnc=jTAC.checkAsInt;break;case"string":fnc=jTAC.checkAsStr;break;case"object":if(val instanceof RegExp){fnc=jTAC.checkAsRegExp}else{if(val instanceof Array){fnc=jTAC.checkAsArray}}break}if(fnc){if(!obj){configrules.prototype[name]=obj={}}obj.valFnc=fnc}}}function _registerNewMethodNames(newClass,parentClass,fullClassName){var skipnames=["config","$parentClass"];var proto=newClass.prototype;for(var name in proto){if(skipnames.indexOf(name)>-1){continue}if(proto.hasOwnProperty(name)){var val=proto[name];if(typeof val=="function"){val.$owner=parentClass;val.$name=name;val.$fullClassName=fullClassName}}}}function silentWarnings(bool){if(!arguments.length){return _silentWarnings}return _silentWarnings=bool}var _silentWarnings=false;var _errorActionStack=[];function pushContext(action,value){if(!action){var c=pushContext.caller;while(!action&&c&&c.$name){action=c.$name;if(["_pushContext"].indexOf(action)>-1){action="";c=c.caller}if(action){action=c.$fullClassName+"."+action+"()"}}}if(action&&(value!=null)){action+=" ["+value.toString()+"]"}_errorActionStack.push(action)}function popContext(){return _errorActionStack.pop()}function actionStack(){return _errorActionStack.join("> ")}function _logAndThrow(msg,inst,action,noThrow,caller,consolemode){if(window.console){if(inst&&inst.$className){msg="["+inst.$fullClassName+"]  Message: "+msg}var as=actionStack();while(!action&&caller&&caller.$name){action=caller.$name;if(["_error","_inputError","_AM","_DM","err"].indexOf(action)>-1){action="";caller=caller.caller}if(action){action=caller.$fullClassName+"."+action+"()"}}if(as){action=as+(action?"> "+action:"")}if(action){msg+="   Context: "+action+""}if(!consolemode||(consolemode=="error")){console.error(msg)}else{eval("console."+consolemode+"(msg);")}if(console.trace){console.trace()}}if(!noThrow){throw new Error(msg)}}var staticMethods={error:function(msg,inst,action,noThrow){_logAndThrow(msg,inst,action,noThrow,this.error.caller,"error")},inputError:function(msg,inst,action,noThrow){_logAndThrow(msg,inst,action,noThrow,this.inputError.caller,"log")},warn:function(msg,inst,action){_logAndThrow(msg,inst,action,true,this.error.caller,"warn")},trimStr:function(value){return(value+"").replace(/^\s+|\s+$/g,"")},escapeRE:function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s:]/g,"\\$&")},delimitedRE:function(text,delim){if(delim==null){delim="\\s"}return new RegExp("(^|"+delim+")"+jTAC.escapeRE(text)+"("+delim+"|$)")},replaceAll:function(text,find,replace,escape){if(escape){find=jTAC.escapeRE(find)}var re=new RegExp(find,"ig");return text.replace(re,replace)},contains:function(text,find,escape){if(escape){find=jTAC.escapeRE(find)}var re=new RegExp(find,"ig");return re.test(text)},htmlEncode:function(text){return String(text).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},checkAsInt:function(value,defaultval){if(value==null){if(defaultval===undefined){jTAC.error("Null is not allowed. Must be an integer.")}else{return defaultval}}if(typeof(value)=="string"){value=parseFloat(value)}if((typeof(value)!="number")||isNaN(value)||(Math.floor(value)!=value)){jTAC.error("Illegal value. Must be an integer.")}return value},checkAsIntOrNull:function(value){if((value==null)||(value==="")){return null}return jTAC.checkAsInt(value)},checkAsNumber:function(value,defaultval){if(value==null){if(defaultval===undefined){jTAC.error("Null is not allowed. Must be an integer.")}else{return defaultval}}if(typeof(value)=="string"){value=parseFloat(value)}if((typeof(value)!="number")||isNaN(value)){jTAC.error("Illegal value. Must be a number.")}return value},checkAsNumberOrNull:function(value){if((value==null)||(value==="")){return null}return jTAC.checkAsNumber(value)},checkAsBool:function(value,defaultval){if(value==null){if(defaultval===undefined){jTAC.error("Null is not allowed. Must be an boolean.")}else{return defaultval}}switch(typeof(value)){case"boolean":break;case"string":if(value.toLowerCase()=="true"){value=true}else{if(value.toLowerCase()=="false"){value=false}else{value=undefined}}break;case"number":if(value==1){value=true}else{if(value==0){value=false}else{value=undefined}}break;default:value=undefined;break}if(value===undefined){jTAC.error("Illegal value. Must be an boolean.")}return value},checkAsBoolOrNull:function(value){if((value==null)||(value==="")){return null}return jTAC.checkAsBool(value)},checkAsStr:function(value,defaultval){if(value==null){if(defaultval===undefined){jTAC.error("Null is not allowed. Must be a string.")}else{return defaultval}}if(typeof(value)=="number"){value=value.toString()}else{if(typeof(value)!="string"){jTAC.error("Illegal value. Must be a string.")}}return value},checkAsStrOrNull:function(value){return jTAC.checkAsStr(value,null)},checkAsClass:function(val,existingObject,classCtor){if(((val==null)||(val==""))&&(existingObject!==undefined)){return existingObject||null}try{jTAC._internal.pushContext("jTAC.checkAsClass");if(val&&(typeof val=="object")&&!val.$className){if(val.jtacClass){val=jTAC.create(null,val)}else{if(existingObject){existingObject.setProperties(val);return existingObject}}}else{if(typeof(val)=="string"){if(val.indexOf("{")==0){try{val=eval("("+val+");")}catch(e){jTAC.error("JSon parsing error. "+e.message,this,null,true)}if(val.jtacClass){val=jTAC.create(null,val)}else{jTAC.error("JSon parsing error. Missing 'jtacClass' property.")}}else{val=jTAC.create(val,null,true)}}}if(val instanceof classCtor){return val}var name=val?val.$fullClassName:(existingObject?existingObject.$fullClassName:"n/a");jTAC.error("Property does not support the class ["+name+"].")}finally{jTAC._internal.popContext()}},checkAsRegExp:function(val){if((val instanceof RegExp)||(val==null)){return val}if(typeof val=="string"){try{return new RegExp(val)}catch(e){jTAC.error("Invalid regular expression pattern. Error: "+e.message)}}jTAC.error("Invalid type in 'val' parameter.")},checkAsArray:function(value,defaultval){if(value==null){if(defaultval===undefined){jTAC.error("Null is not allowed. Must be an integer.")}else{return defaultval}}if(value instanceof Array){return value}jTAC.error("Illegal value. Must be an array.")},checkAsFunction:function(value,defaultval){if(value==null){if(defaultval===undefined){jTAC.error("Null is not allowed. Must be a function.")}else{return defaultval}}if(typeof(value)=="string"){value=window[value];if(!value){jTAC.error("Function ["+value+"] not defined on the window object.")}}if((typeof(value)!="function")){jTAC.error("Illegal value. Must be a function.")}return value},checkAsFunctionOrNull:function(value,defaultval){return jTAC.checkAsFunction(value,null)},extend:function(src,dest,deep){if((typeof src=="object")&&(typeof dest=="object")){for(var name in src){dest[name]=deep?jTAC.clone(src[name]):src[name]}}else{jTAC.error("Illegal param")}},clone:function(item){if(item==null){return null}if(typeof item=="object"){if(item instanceof Array){var a=[];for(var i=0;i<item.length;i++){a[i]=jTAC.clone(item[i])}return a}if(item instanceof Date){return new Date(item.getTime())}if(item.constructor===Object){var newObj={};for(name in item){newObj[name]=jTAC.clone(item[name])}return newObj}}return item}};var publics={define:define,defineAlias:defineAlias,addMembers:addMembers,isDefined:isDefined,createByClassName:createByClassName,create:create,require:require,getClass:getClass,getDefinition:getDefinition,silentWarnings:silentWarnings};staticMethods.extend(staticMethods,publics);publics._internal={definitions:definitions,aliases:aliases,pushContext:pushContext,popContext:popContext,actionStack:actionStack,uniqueid:0,temp:{}};return publics})();var jTACClassBase={$className:null,getName:function(){return $className},$parentName:null,$parentClass:null,$fullClassName:null,$abstract:false,$require:null,config:null,_internal:null,_cache:null,init:function(a){this._reviewDefaults.call(this);if(this.$ctor){this.$ctor.call(this,a)}if(a){if(typeof a=="function"){a.call(this,this,this.$className)}else{this.setProperties.call(this,a)}}},implement:function(a){jTAC.extend(a,this.prototype)},callParent:function(d){if(d&&(typeof d!="object")){this._error("Arguments must be enclosed in an array.")}if(this.$className===undefined){this._error("Only supports classes defined by jTAC.define().")}var c=this.callParent.caller;if(!c){this._error("No caller")}var a=c.$name;if(!a){this._error("Not registered correctly.")}if(!c.$owner){this._error("No parent class defined.")}var b=c.$owner.prototype[a];if(!b){this._error("Parent does not define the method ["+a+"].")}return b.apply(this,d||[])},instanceOf:function(a){var b=this;do{if(b.$fullClassName==a){return true}b=b.$parentClass}while(b!=null);return false},getProperty:function(b){try{this._pushContext(this.$fullClassName+".getProperty('"+b+"')");var c=this._propNameToUpper(b);var a=this["get"+c];if(a){return a.call(this)}return undefined}finally{this._popContext()}},setProperty:function(a,b){try{this._pushContext(this.$fullClassName+".setProperty('"+a+"')");var c=this._propNameToUpper(a);var d=this["set"+c];if(d){d.call(this,b);return true}return false}finally{this._popContext()}},setProperties:function(b){for(var a in b){if(a=="jtacClass"){continue}this.setProperty(a,b[a])}},_propNameToUpper:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},_autoGetSet:function(b,c){function e(k){var j=c.prototype[k]||null;var h=!j||(j.autoGet!=false);var g=!j||(j.autoSet!=false);var i=proto._propNameToUpper(k);var f=proto["get"+i];var l=proto["set"+i];if(!f&&h){proto["get"+i]=function(){return this.config[k]}}if(!l&&g){proto["set"+i]=function(m){this._defaultSetter.call(this,k,m)}}}proto=this.prototype;for(var a in b){var d=b[a];if(d===undefined){continue}e(a)}},_defaultSetter:function(b,d){var c=this.configrules[b];if(c){var e=(typeof c=="function")?c:e=c.valFnc;if(e){d=e.call(this,d)}else{var a=c instanceof Array?c:c.values;if(a){if(a.indexOf(d)==-1){jTAC.error("Requires one of these values: "+a.join(", "))}}}if(c.clearCache){this._clearCache()}}this.config[b]=d},_defineProperties:function(b){for(var a in b.prototype){var c=b.prototype[a];if(c===undefined){continue}this._defineProperty(a)}},_defineProperty:function(b){if(Object.defineProperty){var d=this;var c=d._propNameToUpper(b);var a=d["get"+c];if(a&&(typeof a!="function")){return}var e=d["set"+c];if(e&&(typeof e!="function")){return}Object.defineProperty(d,b,{get:function(){if(a){try{d._pushContext(d.$fullClassName+"."+a.$name);return a.call(d)}finally{d._popContext()}}},set:function(f){if(e){try{d._pushContext(d.$fullClassName+"."+e.$name);e.call(d,f)}finally{d._popContext()}}}})}},_reviewDefaults:function(){var c=this;for(var a in c.config){var d=c.config[a];if(d==null){continue}var b=c._propNameToUpper(a);var e=c["set"+b];if(!e||(typeof e!="function")){continue}e.call(c,d)}},_clearCache:function(){this._cache={};var a=this._internal.children;if(a){for(var b in a){a[b]._clearCache()}}},_registerChild:function(b){var a=this._internal.children;if(!a){a=this._internal.children=[]}a.push(b)},_AM:function(){jTAC.error("Not supported. Abstract method.",this)},_DM:function(){jTAC.error("Not supported method.",this)},_pushContext:function(b,a){jTAC._internal.pushContext(b,a)},_popContext:function(){return jTAC._internal.popContext()},_error:function(b,a){jTAC.error(b,this,a)},_inputError:function(b,a){jTAC.inputError(b,this,a)},_warn:function(c,b,a){jTAC.warn(c,b,a)}};jTAC.translations={register:function(c,a){var b=jTAC.translations[c];if(b==null){jTAC.translations[c]=b={}}jTAC.extend(a,b,true);jTAC.translations.setLanguage(c)},setLanguage:function(a){if(jTAC.translations[a]==null){jTAC.error("Requested the language for ["+a+"]. It has not be registered with jTAC.translations.")}jTAC.translations.current=jTAC.translations[a]},lookup:function(d,f,g){if(!d){return f}var c=jTAC.translations;var b=c.current;if(b==null){return f}if(g&&(b==c[""])){return f}var e=b[d];if((e==null)&&!g){var a=c[""];if(a&&(a!==b)){e=tn[d]}}return e!=null?e:f}};var jTAC_Temp;